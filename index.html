<html>
<head>
	<title>PGRF3 projekt</title>
	<script src="src/three.js"></script>
	<script src="src/libs/THREEx.KeyboardState.js"></script>
	<script src="src/libs/THREEx.FullScreen.js"></script>
	<script src="src/libs/THREEx.WindowResize.js"></script>
	<script src="src/libs/Stats.js"></script>
	<script src="src/libs/OrbitControls.js"></script>
	<script src="src/libs/Detector.js"></script>
	<script src="src/libs/DAT.GUI.js"></script>
	<style type="text/css">
		body{
			margin: 0;
		}
		canvas{
			width: 100%;
			height: 100%;
		}
	</style>
	<script id="vertexShader" type="x-shader/x-vertex">
		
		varying vec2 vUv;
		varying vec4 myTest;
		varying vec3 vPosition;
		varying vec3 vNormal;

		uniform vec3 vLight;

		void main() 
		{ 
		    vUv = uv;
		    float s = position.x * 2.0 - 1.0;
			float t = position.y * 2.0 - 1.0;
			
			vec3 myPosition = vec3(s, t, s * s - t * t);
			vPosition = myPosition;
			myTest =  projectionMatrix * modelViewMatrix * vec4(myPosition,1.0);
		    gl_Position = myTest;
		}
		</script>

		<!-- fragment shader a.k.a. pixel shader -->
		<script id="fragmentShader" type="x-shader/x-vertex"> 
		
		varying vec2 vUv;
		varying vec4 myTest;
		varying vec3 vPosition;
		varying vec3 vNormal;

		uniform vec3 vLight;
		uniform sampler2D texture1;

		void main() 
		{
			vec3 light = normalize(vLight);
			float dProp = max(0.1, dot(vNormal, light));
		    gl_FragColor = texture2D(texture1, vUv) * dProp;
		}  
		</script>
</head>
<body>
</body>
	<script type="text/javascript">

		var controls;
		var t = THREE;

		var scene = new t.Scene();
		var camera = new t.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000 );
		var renderer = new t.WebGLRenderer();

		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);

		controls = new t.OrbitControls(camera, renderer.domElement);

		camera.position.z = 10;
		camera.position.x = 7;
		camera.position.y = 10;

		var light = new t.PointLight(0xffffff);
		light.position.set(0, 15, 0);
		scene.add(light);

		var geometry = new t.PlaneGeometry(2, 2, 100, 100);

		var texture = new t.ImageUtils.loadTexture("img/textures/metal.jpg");
		texture.wrapS = textureWrapT = t.RepeatWrapping;

		var uniforms1 = {
			"vLight": { type: 'v3', value: light.position},
			"texture1": { type: 't', value: texture}
		}

		var material = new t.ShaderMaterial({
			uniforms: uniforms1,
			vertexShader: document.getElementById('vertexShader').textContent,
			fragmentShader: document.getElementById('fragmentShader').textContent,
			wireframe: false,
			side: t.DoubleSide,
			lights: false
		})
		var plane = new t.Mesh(geometry, material);

		scene.add(plane);
		scene.add(light);

		render();

		function render(){
			renderer.render(scene, camera);
			controls.update();
			requestAnimationFrame(render);
		}

	</script>
</html>